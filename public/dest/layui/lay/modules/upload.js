/*! myblog - v1.0.0 - 2017-01-02 */layui.define("layer",function(a){"use strict";var b=layui.jquery,c=layui.layer,d=(layui.device(),"layui-upload-enter"),e="layui-upload-iframe",f={icon:2,shift:6},g={file:"文件",video:"视频",audio:"音频"},h=function(a){this.options=a};h.prototype.init=function(){var a=this,c=a.options,f=b("body"),h=b(c.elem||".layui-upload-file"),i=b('<iframe id="'+e+'" class="'+e+'" name="'+e+'"></iframe>');return b("#"+e)[0]||f.append(i),h.each(function(f,h){h=b(h);var i='<form target="'+e+'" method="'+(c.method||"post")+'" key="set-mine" enctype="multipart/form-data" action="'+(c.url||"")+'"></form>',j=h.attr("lay-type")||c.type;c.unwrap||(i='<div class="layui-box layui-upload-button">'+i+'<span class="layui-upload-icon"><i class="layui-icon">&#xe608;</i>'+(h.attr("lay-title")||c.title||"上传"+(g[j]||"图片"))+"</span></div>"),i=b(i),c.unwrap||i.on("dragover",function(a){a.preventDefault(),b(this).addClass(d)}).on("dragleave",function(){b(this).removeClass(d)}).on("drop",function(){b(this).removeClass(d)}),h.parent("form").attr("target")===e&&(c.unwrap?h.unwrap():(h.parent().next().remove(),h.unwrap().unwrap())),h.wrap(i),h.off("change").on("change",function(){a.action(this,j)})})},h.prototype.action=function(a,d){var g=this,h=g.options,i=a.value,j=b(a),k=j.attr("lay-ext")||h.ext||"";if(i){switch(d){case"file":if(k&&!RegExp("\\w\\.("+k+")$","i").test(escape(i)))return c.msg("不支持该文件格式",f),a.value="";break;case"video":if(!RegExp("\\w\\.("+(k||"avi|mp4|wma|rmvb|rm|flash|3gp|flv")+")$","i").test(escape(i)))return c.msg("不支持该视频格式",f),a.value="";break;case"audio":if(!RegExp("\\w\\.("+(k||"mp3|wav|mid")+")$","i").test(escape(i)))return c.msg("不支持该音频格式",f),a.value="";break;default:if(!RegExp("\\w\\.("+(k||"jpg|png|gif|bmp|jpeg")+")$","i").test(escape(i)))return c.msg("不支持该图片格式",f),a.value=""}h.before&&h.before(a),j.parent().submit();var l=b("#"+e),m=setInterval(function(){var b;try{b=l.contents().find("body").text()}catch(a){c.msg("上传接口存在跨域",f),clearInterval(m)}if(b){clearInterval(m),l.contents().find("body").html("");try{b=JSON.parse(b)}catch(a){return b={},c.msg("请对上传接口返回JSON字符",f)}"function"==typeof h.success&&h.success(b,a)}},30);a.value=""}},a("upload",function(a){var b=new h(a=a||{});b.init()})});